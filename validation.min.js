define(function(t,e,i){"use strict";t("lib/jquery.form");var a=function(t){var e={formId:"#form",validDom:".form-group",validSuccess:function(t,e){$(t).parents(a).removeClass("error").find(".err-msg").text("")},validError:function(t,e){var i;if($(t).parents(a).addClass("error"),$(t).data("msg")===!1)return!1;if(i=$(t).data("msg")||e,$(t).parent().find(".err-tip-content").length<1){var s=$(t).outerWidth(),r=$(t).outerHeight(),n=$(t).position().left+s+7,d=(r-24)/2;$(t).after('<div class="err-tip-content" style="left:'+n+"px;top:"+d+'px;"><div class="err-box"><div class="tri-right"></div><div class="err-msg">'+i+"</div></div></div>")}},ajaxSuccess:function(t){}},i=$.extend({},e,t),a=i.validDom,s=$(i.formId),r=i.validSuccess,n=i.validError,d=i.ajaxSuccess,o=i.beforeSubmit,u=i.reload||0,l=s.find("button[type='submit']"),f=s.find("button[type='submit']").html();$.validate={validator:function(t,e,i){var a={noEmpty:{isValid:function(t){return""==t?!1:!0},message:"不能为空"},email:{isValid:function(t){return/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/i.test(t)},message:"请输入有效的邮箱地址"},number:{isValid:function(t){return/^[0-9]+(.[0-9])?$/.test(t)},message:"请输入数字"},account:{isValid:function(t){return/^[a-zA-Z][a-zA-Z0-9_]{4,10}$/.test(t)},message:"请输入5~10位，账号需字母开头"},safepass:{isValid:function(t){return!/^(([A-Z]*|[a-z]*|\d*|[-_\~!@#\$%\^&\*\.\(\)\[\]\{\}<>\?\\\/\'\"]*)|.{0,5})$|\s/.test(t)},message:"密码由字母和数字组成，至少6位"},same:{isValid:function(t){var e=s.find(".J_old").val();return t==e?!0:!1},message:"两次密码不一致"},mobile:{isValid:function(t){return/^\d{11}$/.test(t)},message:"请输入有效的手机号码"},idCard:{isValid:function(t){return/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(t)},message:"请输入有效的身份证号码"},length:{isValid:function(t,e){var i=JSON.parse(e);return i[1]?t.length>=i[0]&&t.length<=i[1]:t.length>=i[0]},message:"请输入有效的字数"}};return{isValid:a[t].isValid(e,i),message:a[t].message}},handle:function(t,e,i){var a=this.validator,d=s.find(e);d.addClass("validate"),d.on("focus change",function(e){var s=$(this).val(),d=a(t,s,i).message;a(t,s,i).isValid?r($(this)):n($(this),d)})},onSubmit:function(){s.ajaxForm({beforeSubmit:function(){var t=!0;if(s.find(".validate").each(function(){return""==$(this).val()||$(this).parents(a).hasClass("error")?($(this).focus(),t=!1,!1):void 0}),!t)return!1;if(o&&0==o())return!1;var e=s.find("button[type='submit']"),i=e.data("msg")||"保存中...";e.attr("disabled","disabled").html(i),setTimeout(function(){e.removeAttr("disabled","disabled").html(f)},8e3)},success:function(t){d(t),l.removeAttr("disabled","disabled").html(f)},dataType:"json"})}},s.find("[data-validtype]").each(function(){var t,e=$(this).data("validtype"),i=e.indexOf("[");i>-1&&(t=e.substr(i),e=e.substr(0,i)),$.validate.handle(e,$(this),t)}),$.validate.onSubmit()};i.exports=a});